% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sf-methods.R, R/surprise-compute.R
\name{surprise.sf}
\alias{surprise.sf}
\alias{surprise}
\alias{surprise.data.frame}
\alias{surprise.tbl_df}
\title{Compute Bayesian Surprise}
\usage{
\method{surprise}{sf}(
  data,
  observed,
  expected = NULL,
  sample_size = NULL,
  models = c("uniform", "baserate", "funnel"),
  prior = NULL,
  signed = TRUE,
  ...
)

surprise(
  data,
  observed,
  expected = NULL,
  sample_size = NULL,
  models = c("uniform", "baserate", "funnel"),
  prior = NULL,
  signed = TRUE,
  normalize_posterior = TRUE,
  ...
)

\method{surprise}{data.frame}(
  data,
  observed,
  expected = NULL,
  sample_size = NULL,
  models = c("uniform", "baserate", "funnel"),
  prior = NULL,
  signed = TRUE,
  normalize_posterior = TRUE,
  ...
)

\method{surprise}{tbl_df}(data, ...)
}
\arguments{
\item{data}{Data frame, tibble, or sf object}

\item{observed}{Column name (unquoted or string) or numeric vector of observed values}

\item{expected}{Column name or vector of expected values (for base rate model).
If NULL and models include base rate, computed from observed.}

\item{sample_size}{Column name or vector of sample sizes (for funnel model).
Defaults to \code{expected} if not provided.}

\item{models}{Model specification. Can be:
\itemize{
\item A \code{bs_model_space} object
\item A character vector of model types: "uniform", "baserate", "gaussian",
"sampled", "funnel"
\item A list of \code{bs_model} objects
}}

\item{prior}{Numeric vector of prior probabilities for models.
Only used when \code{models} is a character vector or list.}

\item{signed}{Logical; compute signed surprise?}

\item{...}{Additional arguments passed to model likelihood functions}

\item{normalize_posterior}{Logical; if TRUE (default), normalizes posteriors.
If FALSE, uses unnormalized posteriors matching the original Correll & Heer
(2017) JavaScript implementation. Use FALSE to replicate paper results exactly.}
}
\value{
For data frames: the input with \code{surprise} (and optionally
\code{signed_surprise}) columns added, plus a \code{surprise_result} attribute.
For sf objects: a \code{bs_surprise_sf} object.
}
\description{
Main function to compute Bayesian surprise for spatial or tabular data.
This measures how much each observation updates beliefs about a set of models,
highlighting unexpected patterns while de-biasing against known factors.
}
\examples{
# Using sf package's NC data
library(sf)
nc <- st_read(system.file("shape/nc.shp", package = "sf"), quiet = TRUE)

# Basic usage with default models
result <- surprise(nc, observed = SID74, expected = BIR74)

# With specific model types
result <- surprise(nc,
  observed = "SID74",
  expected = "BIR74",
  models = c("uniform", "baserate", "funnel")
)

# With custom model space
space <- model_space(
  bs_model_uniform(),
  bs_model_baserate(nc$BIR74)
)
result <- surprise(nc, observed = SID74, models = space)

# View results
plot(result, which = "signed_surprise")
}
