% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/models-funnel.R
\name{bs_model_funnel}
\alias{bs_model_funnel}
\title{Create a de Moivre Funnel Model}
\usage{
bs_model_funnel(
  sample_size,
  target_rate = NULL,
  type = c("count", "proportion"),
  control_limits = c(2, 3),
  name = NULL
)
}
\arguments{
\item{sample_size}{Numeric vector of sample sizes (e.g., population)}

\item{target_rate}{Target rate/proportion. If NULL, estimated from data.}

\item{type}{Type of data: "count" (Poisson) or "proportion" (binomial)}

\item{control_limits}{Numeric vector of control limits (in SDs) for funnel plot.
Default is c(2, 3) for warning and control limits.}

\item{name}{Optional name for the model}
}
\value{
A \code{bs_model_funnel} object
}
\description{
Creates a model that normalizes observations by their expected standard error,
accounting for varying sample sizes. This addresses "sampling error bias"
where regions with small sample sizes show artificially high variability.
}
\details{
The de Moivre funnel model uses the insight that sampling variability
decreases with sample size according to de Moivre's equation:
\deqn{SE = \sigma / \sqrt{n}}

For count data (Poisson), the model computes z-scores as:
\deqn{z = (observed - expected) / \sqrt{expected}}

For proportion data (binomial):
\deqn{z = (observed - expected) / \sqrt{p(1-p)/n}}

Observations with large z-scores (far from expected after accounting for
sample size) are genuinely surprising, while high rates in small regions
are discounted as expected variation.

This model is essential for:
\itemize{
\item De-biasing per-capita rate maps
\item Creating funnel plots
\item Identifying genuine outliers vs. sampling noise
}
}
\examples{
# Population sizes for regions
population <- c(10000, 50000, 100000, 25000)

# Funnel model for count data
model <- bs_model_funnel(population)

# Funnel model with known target rate
model <- bs_model_funnel(population, target_rate = 0.001)

# For proportion data
model <- bs_model_funnel(population, type = "proportion")
}
